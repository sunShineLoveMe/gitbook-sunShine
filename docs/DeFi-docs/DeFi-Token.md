#### DeFi Token种类以及介绍

#####  DeFi的龙头项目

 ``` sql
交易类：
 Uniswap SushiSwap
 UNiswap 代币名称 UNI 
 
保险：
Nexusn Mutual
 
支付:
 Matic
 
借贷:
 Maker Avvm
 
合成资产:
 Synthetix. UMA
 
加密货币锚定币
 renBTC
 
NFT
  Decentraland
  
聚合理财

预言机
 chainlink
 
钱包
  MetaMark
  
身份和KYC工具
  Civio 
 ```

##### 1. 去中心化交易所(交易类)

###### 介绍

​	去中心化交易所与中心化交易所的区别，主要体现在**技术**和**治理**两个维度。从技术维度来看，去中心化交易所是一个建立在区块链之上的 **DApp**，通过智能合约，实现资产管理及交易两个模块。从治理维度来看，去中心化交易所是一个开放的、由社区驱动的、权利和义务高度分散的**去中心化组织**。

​	去中心化交易所有两种类型 : 第一种是**订单型**交易所，采用**竞价模式**来完成交易。第二种是**算法型**交易所，**基于****流动性池**的交易所，通过自动做市商 *(AMM)* 来完成交易。

​      **订单式去中心化交易所**

​		订单型去中心化交易所中，需要分别匹配一名交易者的买入指令与另一名交易者的卖出指令来完成一笔交易，所有的买卖挂单都存储在区块链中的订单簿（Order Book）上。订单交易的核心概念类似中心化交易所，差别在于中心化交易所采取中心化匹配机制，流动性较强，投资人也无需承担过多滑点。订单型交易所允许交易者提交两种类型的订单，分别是限价订单和市价订单。用户提交市价订单，以最佳的价格购买加密货币。通过将买卖双方的买卖订单配对完成交易。而限价订单则是交易者设定一个指定的价格来购买一定数量的代币。

​		订单型交易所包括 EthFinex、IDEX 和 EtherDelta 等交易所。最具代表性的是 IDEX，订单型去中心化交易所用户体验与中心化交易所类似，登录交易所的方式换成了登录钱包，发出限价订单交易的同时也完成了交易。订单型去中心化交易所的优点是直接通过钱包交易，透明度和安全性较高，但由于整个交易流程都在链上，交易速度较慢，确认时间较长，用户体验难以比拟中心化交易所。订单交易资金深度不够，交易费用较高，也可能因为链上的一些拥堵、Gas 费等原因导致交易失败等情形的发生。订单型去中心化交易所的好处在于，订单型交易所的做市商可以精确控制他们想要购买和出售代币的价格点位。这意味着高资本效率，但同时要求交易所积极参与以及监督流动性的供给。

​    **算法型去中心化交易所**

​		第二种去中心化交易所是基于流动池的算法型去中心化交易所，以 **Uniswap**、**Balancer** 及 **Bancor** 作为代表。算法型去中心化交易所出世的背景在于，去中心化交易所在启动之初往往面临流动性不足的问题，而算法型去中心化交易所则用算法方式提供交易的**流动深度**。算法型去中心化交易所的核心概念在于，资产的价格只有当**交易发生**的时候才会发生变动，更少受到外部的操纵，机制与订单匹配模式有很大的差异。

​		订单匹配模式中的做市商负责在交易所上提供报价行为。如果没有交易活动，交易所将会失去流动性。做市商为了赚取收益，从自己的账户买入和卖出资产。他们的交易活动为其他交易方**创造流动****性**，降低大型交易的滑点。

​		算法型去中心化交易所则是利用**自动做市商** *(Automated Market Makers)* 来模仿做市商的报价行为。常见的做市商算法为恒定乘积做市商及其函数衍生的算法。**恒定乘积做市商**由 Bancor 及 Uniswap 采用，其机制如下：

​		假设恒定乘积做市商已经为这一流动性池注入了 100 枚 A 代币和 1,000 枚 B 代币的资金。Uniswap 将这两个数量相乘*（100 x 1,000 = 100,000）*并设定交易目标：无论交易量大小，该交易对都将始终保持 10 万的交易对乘积数量。恒定乘积做市商是基于函数 **x\*y=z** 建立的。其中 x 和 y 是流动性池中的**代币数量**，z 是**乘积**。要想保持 z 恒定，x 和 y 只能相互反向变动。该函数根据每个代币的流动性来确定两个代币的价格范围。如果交易者对 A 代币的供应量增加，那么 B 代币的供应量必须减少，反之亦然，以保持乘积 z 恒定不变。如果将该函数绘制出来，发现这是一个双曲线，其中流动性始终存在，但是价格会越来越高，并在两端接近无穷大。


​		但是，这样造成自动做市商模式普遍交易深度不足的情况。由于 **y=z/x** ，在 z 不变的情况下，x 的值越大，y 的值越小。这意味着当用户向交易合约中放入越多数量的代币 A，换回的代币 B 数量越少，即交易价格越高。因此，用户难以在 Uniswap 等算法型去中心化交易所上进行**大额交易**，否则将要支付很高的价格。

![Image](https://mmbiz.qpic.cn/mmbiz_png/jNibHMrCMWaYOLzRFS1GMeWyqZ6VicCw22ALIPM0AT7anUpAuGq6gyulAYYuhFDKbwLpAJ8GITJoS83fZAQg9ggw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)*恒定乘积函数下交易对价格*

而随着基于 AMM 模式的流动性的发展，**混合恒定函数**做市商也随之出现，它结合了多种功能和参数，以达到特定的目的。如调整流动性提供者的风险敞口，或者降低交易的价格滑点。例如，**Curve** 的 AMM 结合了恒定乘积及恒定平均值做市算法，以提供资金池的流动性，从而**降低滑点**。

​		但是，算法型交易所目前尚有一些问题有待解决。第一，**无常损失** *(Impermanent Loss)*。流动性提供者所面临的最主要的风险是无常损失，即随着时间变化，流动性提供者在流动池中存入代币和自身在钱包里持有代币之间存在价值差。只要流动池内的代币的市场价格往任意一方偏离，就会产生无常损失。由于流动池内部不能自动调整代币市价的兑换率，因而需要**套利者**通过买入价格偏低的资产或者卖出价格偏高的资产。当一个代币的外部行情发生变化时，套利者可以买入或卖出流动池中现在相对折价的任何代币。在这个过程中，套利者抽取的利润来自于**流动性提供者**的口袋，这会导致无常损失。

![Image](https://mmbiz.qpic.cn/mmbiz_png/jNibHMrCMWaYOLzRFS1GMeWyqZ6VicCw22icNzEcOPM3mbhMYxsI7ldpvOa1FQAOABKbEdR8iaa4OmnFfHyK7pwjuw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)*ETH/DAI 流动池随币价波动造成的无常损失*

​		第二，**多代币风险敞口**。算法型去中心化交易所通常会要求流动性提供者存入两种不同的代币，用意在于为交易双方提供相等的流动性。而去中心化交易所上的 ERC20 代币**品质参差不齐**，这意味着流动性提供者会被强迫承担双代币风险，无法保持对单一代币的长期风险敞口。

​		第三，**资本利用率低**。为了达到低滑点，算法型去中心化交易所的流动池需要储备大量流动性。而由于流动性提供者无法决定流动性的价格点位，价格被动地藉由套利者来平衡，因此大部分算法型去中心化交易所的**流动性利用率**维持在很低的水平。

###### 1.1 Uniswap

​	**Uniswap V1 机制与特点**

​		**Uniswap** 是一个运行在以太坊区块链上的流动性协议，支持去信任的代币互换，这意味着该交易所上的所有交易都是由智能合约自动执行的，用户无需依靠某个中介也无需信任某个第三方。在 Uniswap 平台上，存在三种角色：第一是**流动性提供者**，其风险中立，目的是赚取交易者的手续费。第二是**交易者**，他们在平台中是真正的买家和卖家。三是**套利者**，他们在平台价格与市场价格出现偏差时进行交易获利，并被动的调节平台上的价格。

​		2019 年开始，Uniswap 发展迅速，截止年底，Uniswap 锁定额总价值是 **2910 万美元**。到了 2020 年，Uniswap 发展更加快速。过去一个月的时间里，Uniswap 交易量增长了 10 倍，流动性则增加了 **200%**。Uniswap 之所以在这段时间无论是交易量或用户数量都大幅增加有四个原因：

1. Uniswap 的实施**机制简单**。Uniswap 设计复杂性低，只需智能合约及算法部署完毕，便能自行运营，启动成本低。除此之外，Uniswap 的用户不需要注册，也不需要经过繁琐的 KYC 流程，而只要有以太坊钱包就能进场交易。由于目前以太坊 1.0 有性能上严重的限制，Uniswap 的 gas 费低廉成为一大优势。
2. **用户体\**验良好\****。Uniswap 的恒定乘积做市算法，提供无限价格范围报价，小额交易滑点低。而且在 Uniswap 中提供流动性十分容易，流动性供应来源简单。
3. Uniswap 平台上的**代币无须许可**便可上市，满足长尾代币需求。
4. Uniswap 兴起间 **DeFi 的****基础建设**已经十分丰富。现在有借贷、杠杆、期权、保险等各类衍生品，这些基础设施吸引了大量的资金的进入，为生态提供了充足的流动性。

​		Uniswap 的机制以经济层面而言相当简易合理：Uniswap 向交易者收取少量手续费，并将手续费作为流动性提供者的激励基础，手续费为 **0.3%**。流动性提供者按照注入流动性池的代币数量占整个流动性池数量的比重来分配交易者的手续费。

​		但是，在 Uniswap V1 中并不支持**币币交易**，也就是说，如果交易者要将代币 A 兑换成代币 B ，必须先用代币 A 买入 ETH ，然后再用 ETH 买入代币 B 。交易者需要支付两笔交易费和 gas 费，相当不直观。

**Uniswap V2**

​		Uniswap 在 2020 年 **3 月**进行了一次的迭代，将 Uniswap 升级为 **Uniswap V2**，主要的改动有三个。第一，ERC20 对 ERC20 代币的交易对。Uniswap V2 不再需要 ETH 作为中间兑换代币来协助 ERC20 币币交易。预期可以减少一半的交易量，也能**节约交易的 Gas 费**。如果交易者试图交易的代币之间没有流动池，可以利用迂回的路由更高效获得想交易的交易对，而无须通过壅堵的 ETH。

​		第二，**闪电交易** *(Flash Swap)*。闪电交易的过程有三步骤 : 一是从 Uniswap 的流动性池中借出代币。二是使用这些代币进行某项操作。三是偿还这些代币。如果这个流程中的任意一阶段失败，所有状态更改都会撤销，相关代币重新回到对应的 Uniswap 流动池中，交易具有**原子性**。闪电交易主要用途是套利交易，交易者能在低成本的情况下进行套利。获利的同时将之前借得的代币价值归还至 Uniswap 流动性池内，相比直接使用自己持有的代币来还款，这种方式消耗的 gas 较少。

​		第三，**价格预言机**。Uniswap 的价格由函数曲线所决定，因此常常偏离市场价格。Uniswap V2 引入价格预言机来改善这个问题。在 Uniswap 一个交易发生之前，每个交易对都会衡量每个区块开始时的市场价格，每个区块开始时的价格为上个区块最后一笔交易的成交价格。若攻击者试图操纵价格，需要连续做多笔偏离市场价格的交易，并且其中没有套利者参与。
​		除此之外，Uniswap V2 在智能合约中设定一个累计价格变量，该变量是由**成交价格存在的时间**来加权的。这个变量代表着合约的整个 Uniswap 历史中的每秒价格的总和。外部可以使用这一变量在任何时间间隔内追踪 Uniswap 中由时间加权的历史平均价格。采取这种方式可以避免市场崩盘和剧烈的价格波动，以及提升攻击者的成本。但是，Uniswap 利用时间加权平均价格是对结果进行**事后修正**，无法精准地呈现市场价格，对于主流交易对币种而言，Uniswap 无法掌握定价权，需要依赖其他交易所。

**Uniswap 对未来交易所影响与其瓶颈**

**瓶颈**

交易所天然会受到**网络效应**的影响，因为交易者希望在流动性最好的平台交易。由于套利者可以调节流动性池，这种流动性的网络效应也有一定的限度。去中心化交易所相比于传统的中心化交易所，其去中心化的思想较符合区块链的初衷，若解决了性能及架构设计的问题，长远来看可能会赢得更多的支持。但在监管方面，传统的中心化交易所逐渐向**监管合规**靠拢，利用实名制或是 KYC 等机制进行监管，结合第三方安全公司的支持*（如 AML 系统）*，可以有效的避免洗钱或加密货币犯罪。去中心化交易所则始终难以监管，主要体现在两个层面：

1. 第一是用户，Uniswap 或一些去中心化交易所无法掌握用户的基本身份，也不需要进行 KYC 审查，这意味着**金融犯罪**的可能性。犯罪者可以利用去中心化交易所掩盖资金流向，甚至利用发行新币进行洗钱。
2. 第二是项目，大多数的去中心化交易所虽然不会像中心化交易所那样收取上币费，但是也造成去中心化交易所平台上的项目**品质参差不齐**，比如 Uniswap 上的项目并不需要经过审查即能在平台上交易，平台容易承受较大的**法律风险**。除此之外，去中心化交易所的交易深度不足，无法支持大额交易。当有大额交易发生时，容易造成溢价交易。

**影响**

​		**算法型去中心化交易所**可以对未来加密货币交易所有深远的影响，未来无论是中心化或去中心化的加密货币交易所可以在一些基本改进的基础下应用这个模式。这些改进包括采用联盟链或私有链、交易用户的身份认证及 KYC、合规的加密货币的使用审查等等。Uniswap 模式的应用可以提供传统证券交易所另一种可能的选择，主要可以体现在两个部分：

1. 由于不需要订单撮合模式，**交易商品的广度**能大幅增加，且流动性也无须做市商来提供，可以节省相关做市商的成本。由于任何人都可以参与提供流动性并且从中获利，交易所的运行完全基于市场的需求进行。

   

2. 越来越多去中心化交易所就 Uniswap 的**算法进行改良**，试图解决大额交易滑点高及无常损失等问题。举例来说，Bancor V2 通过和 **Chainlink** 预言机合作，能够建立波动资产的**低滑点模型**，交易对价格除了由套利者决定外，还可以由预言机提供价格更新，有效地避免流动性提供者的无常损失。

   ​	总而言之，目前 Uniswap V2 能在以下交易情况发挥到最大效果 : 一是**长尾交易者**数量众多，并且进行频繁小额交易。二是交易对市场**波动率低**。三是交易对**流动****资金池**具备足够规模。

   

   ​	虽然目前去中心化交易所成长飞速，但是绝大部分的交易量依旧是在中心化交易所里，币安*（Binance）*平均日交易量接近 **50 亿美金**，而 Uniswap 最高的日交易量也不过其 2%。未来去中心化交易所如何克服**安全的顾虑**以及**流动性问题**将会是去中心化交易所继续成长的关键。

   

###### 1.2 SunshiSwap



**SushiSwap 崛起**

​		据 DeBank 数据统计，**SushiSwap** 在 9 月 14 日的平均日交易量跃升至第二大去中心化交易所，达到 1 亿 5000 万美元。链上的锁仓量也超过 13 亿美元，超过 MakerDao 成为 DeFi **第二大协议**，并让 Uniswap 失去超过 70% 的流动性。SushiSwap 可以理解为 Uniswap 协议加上**流动性挖矿**机制。Uniswap 的流动性提供者只有在他们提供流动性时才赚取资金池的交易费。一旦他们撤回资金池中自己的资金，将不再获得相应的收入。并且，无常损失时常削减他们的收益。

​		随着生态发展，流动性提供者越来越多，早期流动性提供者的收益会被摊薄。而 SushiSwap 的流动性提供者则可以在获得交易费的同时，以 **Sushi 代币**的形式获得额外流动性挖矿奖励。并且与 Uniswap 不同的是，即使流动性提供者不再提供其资金，其原先获得的 Sushi 代币可以转化为分红代币，捕获 SushiSwap 未来成长的价值。 

​		SushiSwap 可以说是 Uniswap 的进阶版，其设计的机制很大程度的吸引了流动性提供者的进驻，但有几个风险需要注	意：

1. 长期而言，SushiSwap 流动性挖矿机制无法提升**普通参与者**提供流动性的意愿。由于普通用户的资金体量有限，因此相对于机构投资者以及拥有大笔资金的投机客而言，普通的流动性提供者获得的 Sushi 代币几乎可以忽略不计。
2. SushiSwap 发行代币**总量无上限**，且目前以每天 550 万枚代币的数量挖矿，即使到了第二阶段，代币还是会以每天 55 万枚的数量挖出。虽然 SushiSwap 设计以 0.05% 交易费速度回购，但 SushiSwap 有通胀压低币值的可能性，进而影响流动性提供者参与的意愿。
3. SushiSwap 虽然声称将会将智能合约交由技术审计公司进行审计，但目前尚未有正式的安全审计结果，**代码安全性**尚未可知。

##### 2.预言机

###### 	介绍

​    	区块链上数据整体来看都是线性的，一旦上链就不可篡改。现实生活中，许多事情都是非线性的在发展。所以选择什么数据上链，怎么上链以及如何进行数据交互就非常关键。预言机就应运而生。

   2.1 oracle 是什么

​        预言机，英文名为Oracle，本质上是这一种数据调用和访问的中间件。它分别解决了是或否和数据是多少两类问题，从而实现智能合约对外部数据的调用。它既可以从原生的链上获取数据，也可以通过爬虫或者从可信的第三方机构从链下获取数据。预言机最主要的分两类，分别是对应数据的输入和输出。第一种预言机的类型更为常见。

​      输入型预言机将会将链外的或者现实的数据带上区块链，而输出类则会向区块链外发送链上的相应信息，简单来说，输入型预言机允许将与真实事件相关的有关数据调用到链上，其中包括基于现有资产价格的自动化交易，以及各类博彩的Dapp的实时金额支付。智能合约里会包含多类规则，预言机会为这些合约提供触发和执行规则所需要的数据，输出型预言机则会将发生在链上的时间通知链外的参与者。从理论上来讲，输出型预言机的真实使用案例要比输入型的预言机少很多。

###### 与DeFi结合

  预言机作为区块链与现实世界进行数据交互的桥梁，应用场景非常丰富，可以说一切需要与链下进行数据交互的Dapp都需要预言机。比如金融衍生品交易平台、借贷平台、IoT、稳定币、博彩游戏、大数据交易市场、保险、预测市场等，目前最主要的场景就是DeFi。

​		首先，DeFi 产品需要预言机。类似DAI这样的稳定币系统，需要获取ETH实时价格来判断所抵押的加密货币是否达到了平仓价格进而触发平仓。假设有1000个节点，那就需要向交易所或者CoinMarketCap 的ETH/USDT 交易对进行1000次API数据请求。但由于 ETH 的价格是实时变动的，加上网络延迟、计算速度等原因，每个节点获取到的价格可能都不相同，这部分数据被输入到智能合约后，节点间无法达成共识，那么整个系统就会崩溃。所以在 DeFi 领域稳定币、去中心化杠杆交易、金融衍生品交易等都需要预言机，只是短期内大多数项目选择使用自己搭建的预言机服务，但实际上这会有很多问题，比如单点故障、易受攻击等，比如知名的衍生品交易平台 Synthetix 在 19 年 6 月份遭遇了攻击，损失超过 3700 万枚 sETH。

​		**其次，博彩类 DApp 需要预言机。**博彩游戏的核心是不可预测、可验证的随机数，从而决定赌注的最终结果，但是在链上是无法生成随机数的或者说在链上的随机数是可以被预测和破解的，这时候就需要预言机从外部给智能合约安全的、不可预测的随机数。

​		此外，对于市场预测、保险、IOT 领域，预言机 大数据领域也都有着广泛的应用。

###### 预言机的常见应用场景

**获得汇率、借贷利率等信息**

  DeFi和预言机是天生的好伙伴，很多DeFi借贷项目都会用到预言机。比如很多稳定币并不是真实的1:1的价值锚定，会有一些小波动，像Maker的美元稳定币DAI，你可以使用预言机来获得DAI的实时汇率；还有像SALT Lending这种借贷平台，可以使用预言机在贷款生成时提供价格数据，并且能监控抵押物的保证金比率，在保证金不足的时候发出警告并触发清算程序

**获得代币价格等信息**

​	现在很多最新的DEX使用的是流动池模式，而非传统的订单簿模式，流动池就是由提供流动性的用户将一堆代币放到一个资金池里，用于给交易者提供深度。流动池代币的价格就可以使用预言机来获取，而且还可以根据预言机提供的价格来动态调整代币池的比重

**获取随机数**

​	区块链菠菜应用可以说是最早发展起来的应用了，很多菠菜DApp都会用到随机数，但是我们要知道，计算机本身不可能产生完全随机的数字，计算机本身产生的叫伪随机数，所以在封闭状态的链上无法产生安全的随机数。这时候就需要用到预言机来获取随机数了，预言机可以配合现实世界的一些事件来生成随机数

**获取现实世界的数据**

​	一些去中心化保险产品，相比利益驱动的保险公司，会更信任代码。除了常见的DeFi产品的保险外，还有一种参数保险，它是一种带有参数触发器和付款条件的特殊保险，比如Etherisc推出了航班延误保险和飓风保险，它就可以使用预言机来获得航班是否延误的数据，或者哪里受到了飓风影响，从而判断是否触发理赔条件

###### 2.1 link ChainLink

​		ChainLink 是区块链行业最早的预言机项目，其创世人也是区块链行业的早期参与者之一。ChainLink 项目从2014年开始启动，2017年正式上线，旨在解决世界区块链领域一个重要问题即区块链与外部数据交互方面的问题。

​		ChainLink 主要涵盖了：

​		建立一个分布式Oracle数据网络来与现实世界数据进行交互，为更多的应用场景提供标准化解决方案，比如财务数据传输、金融协议、保险等。 ChainLink 能够与区块链外的服务完美结合并进行无缝交互，比如支付、执行合同，以及任何可以通过API执行的任务。

​		币价跌宕起伏的同时，Chainlink 的发展也极具戏剧性，从沉寂到被死亡到再到复苏崛起，Chainlink 的发展史宛如一段激昂的奋斗史，目前在 CoinMarketCap 上市值排名第五 , 远超其他预言机项目。同时，Link 的生态也非常丰富，和许多区块链项目以及传统公司都有着或多或少的合作关系。Link 的技术白皮书写得也非常详尽